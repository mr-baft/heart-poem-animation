<!DOCTYPE html>
<html lang="fa">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Heart & PoemğŸ’”</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/vazirmatn@33.0.4/Vazirmatn-font-face.css"
      rel="stylesheet"
    />
    <style>
      * {
        font-family: "Vazirmatn", "Noto Serif", sans-serif;
      }

      body {
        margin: 0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: linear-gradient(#0f0f1a, #1a1a2e);
        font-family: "Vazirmatn", "Noto Serif", sans-serif;
      }
      canvas {
        display: block;
        width: 100%;
        height: 100%;
        max-width: 800px;
        max-height: 600px;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
      }
      #controls {
        margin-top: 10px;
        display: flex;
        gap: 10px;
        align-items: center;
      }

      #songSelect {
        padding: 8px 32px;
        font-size: 14px;
        background-color: rgba(30, 30, 50, 0.8);
        color: #e0e0e0;
        border: 1px solid #3a3a5a;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: "Vazirmatn", "Noto Serif", sans-serif;
      }

      #resetButton {
        padding: 8px 32px;
        font-size: 14px;
        background-color: rgba(101, 28, 28, 0.8);
        color: #e0e0e0;
        border: 1px solid #6f2f2f;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: "Vazirmatn", "Noto Serif", sans-serif;
      }

      #songSelect:hover {
        background-color: #3a3a5a;
        color: #ffffff;
      }

      #resetButton:hover {
        background-color: #5a3a3a;
        color: #ffffff;
      }

      #songSelect {
        background-color: rgba(30, 30, 50, 0.8);
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        padding-right: 30px;
        background-image: url('data:image/svg+xml;utf8,<svg fill="%23e0e0e0" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
        background-repeat: no-repeat;
        background-position: left 10px center;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <select id="songSelect">
        <option value="0">Ú¯Ø°Ø´ØªÙ… Ø§Ø²Øª - Ú†Ø§ÙˆÙˆØ´ÛŒ</option>
        <option value="1">Ú©Ø¬Ø§ÛŒÛŒ - Ú†Ø§ÙˆÙˆØ´ÛŒ</option>
        <option value="2">Ø¨Ø¹Ø¯ Ø§Ø² ØªÙˆ - Ú†Ø§ÙˆÙˆØ´ÛŒ</option>
      </select>
      <button id="resetButton">Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
    </div>
    <script>
      let blade = {
        x: 400,
        y: 300,
        displayX: 400,
        displayY: 300,
        width: 60,
        height: 120,
      };

      let heartPieces = [];
      let scratches = [];
      let bloodParticles = [];
      let rainDrops = [];
      let poemParticles = [];
      let isBladeActive = false;
      let heartImg, bladeImg;
      //   let bgMusic = [];
      let introMessage = true;
      let endAnimation = false;
      let endAlpha = 0;

      let poems = [
        [
          "Ù‡Ù…ÙˆÙ†Ù… Ù‡Ù…ÙˆÙ† Ú©Ù‡ Ø¨Ø§ Ø¯Ø³Øª ØªÙ†Ú¯ ØªÙˆ Ù…Ø´ØªÙ… Ø¨Ø±Ø§Øª ØµØ¯Ù Ø¯Ø§Ø´ØªÙ…",
          "Ø¨Ø§ Ø§ÛŒÙ† Ø­Ø§Ù„ Ù‡Ù… Ø¨Ù‡ Ù‡Ø±Ú©ÛŒ Ú©Ù‡ ØªÙˆ Ø¯Ù„Øª Ø®ÙˆÙ†Ù‡ Ú©Ø±Ø¯ Ø´Ø±Ù Ø¯Ø§Ø´ØªÙ…",
          "Ú¯Ø°Ø´ØªÙ… Ø§Ø²Øª Ù†Ú¯Ø§Ù‡ Ú©Ù† Ù…Ù†Ùˆ Ù†Ù‡ Ø­Ø§Ù„Ù… Ø¨Ø¯Ù‡ Ù†Ù‡ Ú†Ø´Ù…Ù… ØªØ±Ù‡",
          "Ø´Ø¨ Ø¢Ø®Ø±Ù‡ ØªÙˆÙ‡Ù… Ù‡Ø±ÙˆÙ‚Øª Ø§Ø²Ù… Ø¯ÙˆØ± Ø´ÛŒ ÙˆØ§Ø³Øª Ø¨Ù‡ØªØ±Ù‡",
          "Ø´Ú©Ø³ØªÙ… Ø¯Ø±Ø³Øª Ø¨Ø±ÛŒØ¯Ù… Ù‚Ø¨ÙˆÙ„ Ù…ÛŒâ€ŒØ¯ÙˆÙ†ÛŒ Ú©Ù‡ Ù…Ù† ÛŒÙ‡ Ø¯Ù†Ø¯Ù… Ù‡Ù†ÙˆØ²",
          "ØªÙ…Ø§Ø´Ø§Ù… Ú©Ù† Ù‡Ù…Ù‡ Ø²Ù‡Ø±Ù…Ùˆ Ú©Ø´ÛŒØ¯Ù† ÙˆÙ„ÛŒ Ú©Ø´Ù†Ø¯Ù… Ù‡Ù†ÙˆØ²",
          "Ù…Ù†Ùˆ Ù‡ÛŒÚ†Ú©Ø³ Ù…Ù†Ùˆ Ù‡ÛŒÚ†ÛŒ Ù…Ø«Ù„ Ø­Ø±Ù ØªÙˆ Ù†Ø³ÙˆØ²ÙˆÙ†Ø¯Ù‡ Ø¨ÙˆØ¯",
          "Ù‡Ù…ÛŒÙ† Ù…ÙˆÙ†Ø¯Ù‡ Ø¨ÙˆØ¯ Ø®Ø±Ø§Ø¨Ù… Ú©Ù†ÛŒ Ø¬ÙˆØ§Ø¨Ù… Ú©Ù†ÛŒ Ù‡Ù…ÛŒÙ† Ù…ÙˆÙ†Ø¯Ù‡ Ø¨ÙˆØ¯",
        ],
        [
          "ÛŒÙ‡ Ù¾Ø§ÛŒÛŒØ² Ø²Ø±Ø¯ Ùˆ Ø²Ù…Ø³ØªÙˆÙ† Ø³Ø±Ø¯ Ùˆ",
          "ÛŒÙ‡ Ø²Ù†Ø¯ÙˆÙ† ØªÙ†Ú¯ Ùˆ ÛŒÙ‡ Ø²Ø®Ù… Ù‚Ø´Ù†Ú¯ Ùˆ",
          "ØºÙ… Ø¬Ù…Ø¹Ù‡ Ø¹ØµØ± Ùˆ ØºØ±ÛŒØ¨ÛŒ Ø­ØµØ± Ùˆ",
          "ÛŒÙ‡ Ø¯Ù†ÛŒØ§ Ø³ÙˆØ§Ù„Ùˆ ØªÙˆ Ø³ÛŒÙ†Ù… Ú¯Ø°Ø§Ø´ØªÛŒ",
          "Ø¬Ù‡Ø§Ù†ÛŒ Ø¯Ø±ÙˆØº Ùˆ ÛŒÙ‡ Ø¯Ù†ÛŒØ§ ØºØ±ÙˆØ¨ Ùˆ",
          "ÛŒÙ‡ Ø¯Ø±Ø¯ Ø¹Ù…ÛŒÙ‚ Ùˆ ÛŒÙ‡ ØªÛŒØ²ÛŒ ØªÛŒØº Ùˆ",
          "ÛŒÙ‡ Ù‚Ù„Ø¨ Ù…Ø±ÛŒØ¶ Ùˆ ÛŒÙ‡ Ø¢Ù‡ ØºÙ„ÛŒØ¸ Ùˆ",
          "ÛŒÙ‡ Ø¯Ù†ÛŒØ§ Ù…Ø­Ø§Ù„Ùˆ ØªÙˆ Ø³ÛŒÙ†Ù… Ú¯Ø°Ø§Ø´ØªÛŒ",
          "Ø±ÙÛŒÙ‚Ù… Ú©Ø¬Ø§ÛŒÛŒØŸ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ú©Ø¬Ø§ÛŒÛŒØŸ",
          "Ú©Ø¬Ø§ÛŒÛŒ ØªÙˆ Ø¨ÛŒ Ù…Ù†ØŒ ØªÙˆ Ø¨ÛŒ Ù…Ù† Ú©Ø¬Ø§ÛŒÛŒØŸ",
          "ÛŒÙ‡ Ø¯Ù†ÛŒØ§ ØºØ±ÛŒØ¨Ù…",
          "Ú©Ø¬Ø§ÛŒÛŒ Ø¹Ø²ÛŒØ²Ù…",
          "Ø¨ÛŒØ§ ØªØ§ Ú†Ø´Ø§Ù…Ùˆ ØªÙˆ Ú†Ø´Ù…Ø§Øª Ø¨Ø±ÛŒØ²Ù…",
          "Ù†Ú¯Ùˆ Ø¯Ù„ Ø¨Ø±ÛŒØ¯ÛŒ Ø®Ø¯Ø§ÛŒÛŒ Ù†Ú©Ø±Ø¯Ù‡",
          "Ø¨Ø¨ÛŒÙ† Ø®ÙˆØ§Ø¨ Ú†Ø´Ù…Ø§Øª Ø¨Ø§ Ú†Ø´Ù…Ø§Ù… Ú†Ù‡ Ú©Ø±Ø¯Ù‡",
          "Ù‡Ù…Ù‡ Ø¬Ø§ Ø±Ùˆ Ú¯Ø´ØªÙ…",
          "Ú©Ø¬Ø§ÛŒÛŒ Ø¹Ø²ÛŒØ²Ù…",
          "Ø¨ÛŒØ§ ØªØ§ Ø±Ú¯Ø§Ù…Ùˆ ØªÙˆ Ø®ÙˆÙ†Øª Ø¨Ø±ÛŒØ²Ù…",
          "Ø¨ÛŒØ§ Ø±ÙˆØªÙˆ Ø±Ùˆ Ú©Ù† Ù…Ù†Ùˆ Ø²ÛŒØ± Ùˆ Ø±Ùˆ Ú©Ù†",
          "Ø¨ÛŒØ§ Ø²Ø®Ù…Ø§Ù…Ùˆ ÛŒÙ‡ Ø¬ÙˆØ±ÛŒ Ø±ÙÙˆ Ú©Ù†",
          "Ø¹Ø²ÛŒØ²Ù… Ú©Ø¬Ø§ÛŒÛŒØŸ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ú©Ø¬Ø§ÛŒÛŒØŸ",
          "Ú©Ø¬Ø§ÛŒÛŒ ØªÙˆ Ø¨ÛŒ Ù…Ù†ØŒ ØªÙˆ Ø¨ÛŒ Ù…Ù† Ú©Ø¬Ø§ÛŒÛŒØŸ",
        ],
        [
          "Ù…Ù† Ø¯Ù„Ù… Ø§Ø² Ø¯Ø³Øª Ø¯Ù†ÛŒØ§ Ø®ÙˆÙ†Ù‡ Ø¯ÛŒÚ¯Ù‡",
          "Ù…ÛŒØ±Ù… Ø§Ø² Ù…Ù† Ø³Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ù…ÛŒâ€ŒÙ…ÙˆÙ†Ù‡ Ø¯ÛŒÚ¯Ù‡",
          "Ø³ÛŒÙ†Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø§Ø³Ù… ØªÙˆ ÙØ±ÛŒØ§Ø¯ Ù…ÛŒâ€ŒØ²Ø¯",
          "Ø¨Ø¹Ø¯ ØªÙˆ Ø³ÛŒÙ†Ù‡â€ŒÛŒ Ù‚Ø¨Ø±Ø³ØªÙˆÙ†Ù‡ Ø¯ÛŒÚ¯Ù‡",
          "Ú¯Ø± Ú¯Ø±ÙØªÙ… Ù…Ø«Ù„ ÛŒÙ‡ Ø¨Ø§Øº Ù‡Ø±Ø§Ø³ÙˆÙ†",
          "Ù‚Ø¯ Ú©Ø´ÛŒØ¯Ù… Ù…Ø«Ù„ ÛŒÙ‡ ÙÙˆØ§Ø±Ù‡â€ŒÛŒ Ø®ÙˆÙ†",
          "Ø§ÛŒÙ† Ù…Ø³ÛŒØ± Ø±Ùˆ Ø¨Ø±Ù†Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ù… Ø¯ÙˆØ¨Ø§Ø±Ù‡",
          "Ø¯Ø³Øª Ø¨Ø¬Ù†Ø¨ÙˆÙ†ØŒ Ù…Ø±Ú¯ Ø®Ø³ØªÙ…ØŒ Ø¯Ø³Øª Ø¨Ø¬Ù†Ø¨ÙˆÙ†",
          "Ù¾Ù„Ú© Ù…ÛŒâ€ŒØ¨Ù†Ø¯Ù… Ù…ÛŒÙˆÙ† Ú¯Ø±ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒâ€ŒØ§Ø±Ø§Ø¯Ù‡â€ŒÙ…",
          "Ø¯Ø³ØªØªÙˆ Ø¯ÙˆØ±Ù… Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ØŒ Ù…Ù† ÛŒÙ‡ Ø´Ù…Ø¹ Ø±Ùˆ Ø¨Ù‡ Ø¨Ø§Ø¯Ù…",
          "Ù…Ù† Ù…Ø«Ù„ Ø²ÛŒØ¨Ø§ÛŒÛŒ ØªÙˆ Ø§Ø² Ø³Ø± Ø¯Ù†ÛŒØ§ Ø²ÛŒØ§Ø¯Ù…",
          "Ù‡Ù… Ø®ÙˆØ¯Ù… Ù…Ø±Ø¯Ù… Ø¹Ø²ÛŒØ²Ù…ØŒ Ù‡Ù… Ø¹Ø²ÛŒØ² Ø§Ø² Ø¯Ø³Øª Ø¯Ø§Ø¯Ù…",
          "Ú†Ø´Ù… ÙˆØ§ Ú©Ø±Ø¯Ù… Ú©Ù‡ Ø¯Ù†ÛŒØ§ Ø±Ùˆ Ø¨Ø¨ÛŒÙ†Ù…",
          "Ø³Ù†Ú¯ Ù‚Ø¨Ø±Ø§Ø±Ùˆ Ø¨Ù‡ Ø§Ø³Ù…Ù… Ú©Ø±Ø¯Ù‡ Ø¨ÙˆØ¯Ù†",
          "Ú†ÛŒ Ø¨Ú¯Ù… ØªØ§ Ø¨Ø§ÙˆØ±Øª Ø´Ù‡ Ø¨ÛŒâ€ŒÚ¯Ù†Ø§Ù‡Ù…ØŸ",
          "Ú†ÛŒ Ø¨Ú¯Ù… ÙˆÙ‚ØªÛŒ Ø·Ù„Ø³Ù…Ù… Ú©Ø±Ø¯Ù‡ Ø¨ÙˆØ¯Ù†ØŸ",
          "Ø¯Ø±Ø¯ Ø¯Ø§Ø±Ù‡ Ø§ÛŒÙ† Ú©Ù‡ Ù¾Ø§Ø³ÙˆØ² ÛŒÙ‡ Ø´Ù‡Ø±ÛŒÙ…",
          "Ø§ÛŒÙ† Ú©Ù‡ Ø¯Ù„Ø³ÙˆØ²ÛŒ Ù†Ø¯Ø§Ø±ÛŒÙ… Ø¯Ø±Ø¯ Ø¯Ø§Ø±Ù‡",
          "Ø¯Ø±Ø¯ Ø¯Ø§Ø±Ù‡ Ø§ÛŒÙ† Ú©Ù‡ ÙˆØ§ÛŒØ³ØªÛŒ ØªØ§ Ø®ÙˆØ¯ Ù…Ø±Ú¯",
          "Ø§Ø² ØªÙ†Øª Ø±Ø®Øª Ø¹Ø²Ø§ Ø±Ùˆ Ø¯Ø± Ø¨ÛŒØ§Ø±Ù‡",
          "Ù¾Ù„Ú© Ù…ÛŒâ€ŒØ¨Ù†Ø¯Ù… Ù…ÛŒÙˆÙ† Ú¯Ø±ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒâ€ŒØ§Ø±Ø§Ø¯Ù‡â€ŒÙ…",
          "Ø¯Ø³ØªØªÙˆ Ø¯ÙˆØ±Ù… Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ØŒ Ù…Ù† ÛŒÙ‡ Ø´Ù…Ø¹ Ø±Ùˆ Ø¨Ù‡ Ø¨Ø§Ø¯Ù…",
          "Ù…Ù† Ù…Ø«Ù„ Ø²ÛŒØ¨Ø§ÛŒÛŒ ØªÙˆ Ø§Ø² Ø³Ø± Ø¯Ù†ÛŒØ§ Ø²ÛŒØ§Ø¯Ù…",
          "Ù‡Ù… Ø®ÙˆØ¯Ù… Ù…Ø±Ø¯Ù… Ø¹Ø²ÛŒØ²Ù…ØŒ Ù‡Ù… Ø¹Ø²ÛŒØ² Ø§Ø² Ø¯Ø³Øª Ø¯Ø§Ø¯Ù…",
        ],
      ];

      let currentPoem = poems[0];
      let poemIndex = 0;

      let heart = {
        x: 400,
        y: 300,
        size: 212,
        health: currentPoem.length + 1,
        shake: 0,
      };

      function preload() {
        heartImg = loadImage("heart-svgrepo-com.svg");
        bladeImg = loadImage("knife-svgrepo-com.svg");
        // Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ³ÛŒÙ‚ÛŒØŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ MP3 Ø±Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù† Ùˆ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ Ø±Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø°Ø§Ø±
        // bgMusic[0] = loadSound("https://cdn.glitch.global/your-project-id/passtam-azat.mp3");
        // bgMusic[1] = loadSound("https://cdn.glitch.global/your-project-id/kojai.mp3");
        // bgMusic[2] = loadSound("https://cdn.glitch.global/your-project-id/baad-az-to.mp3");
      }

      function setup() {
        let canvas = createCanvas(
          min(windowWidth, 800),
          min(windowHeight, 600)
        );
        canvas.style("display", "block");
        textFont("Vazirmatn", 16);
        textAlign(CENTER);
        heart.x = width / 2;
        heart.y = height / 2;
        blade.x = width / 2;
        blade.y = height / 2;
        heart.health = currentPoem.length + 1;
        for (let i = 0; i < 100; i++) {
          rainDrops.push({
            x: random(width),
            y: random(height),
            speed: random(4, 8),
            length: random(10, 20),
          });
        }

        let songSelect = document.getElementById("songSelect");
        songSelect.addEventListener("change", function () {
          currentPoem = poems[parseInt(this.value)];
          // Ø§Ú¯Ø± Ù…ÙˆØ³ÛŒÙ‚ÛŒ Ø¯Ø§Ø±ÛŒØŒ Ù…ÙˆØ³ÛŒÙ‚ÛŒ Ù‚Ø¨Ù„ÛŒ Ø±Ùˆ Ù…ØªÙˆÙ‚Ù Ú©Ù† Ùˆ Ø¬Ø¯ÛŒØ¯ Ø±Ùˆ Ù¾Ø®Ø´ Ú©Ù†
          // if (bgMusic[songSelect.value]) {
          //   bgMusic.forEach((sound, i) => {
          //     if (i != songSelect.value && sound.isPlaying()) sound.stop();
          //   });
          //   bgMusic[songSelect.value].loop();
          // }
          resetAnimation();
        });

        let resetButton = document.getElementById("resetButton");
        resetButton.addEventListener("click", resetAnimation);
      }

      function draw() {
        // ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ health
        let red = map(heart.health, currentPoem.length + 1, 0, 15, 50);
        background(red, 15, 26, 200);
        fill(red, 15, 26, 50);
        rect(0, 0, width, height);

        // Ø¨Ø§Ø±Ø§Ù†
        stroke(100, 100, 150, 150);
        strokeWeight(1);
        for (let drop of rainDrops) {
          line(drop.x, drop.y, drop.x, drop.y + drop.length);
          drop.y += drop.speed;
          if (drop.y > height) {
            drop.y = -drop.length;
            drop.x = random(width);
          }
        }

        // Ø­Ø±Ú©Øª Ú†Ø§Ù‚Ùˆ
        if (touches.length > 0) {
          blade.x = lerp(blade.x, touches[0].x, 0.2);
          blade.y = lerp(blade.y, touches[0].y, 0.2);
        } else {
          blade.x = lerp(blade.x, mouseX, 0.2);
          blade.y = lerp(blade.y, mouseY, 0.2);
        }

        // // Ù¾ÛŒØ§Ù… Ø§ÙˆÙ„ÛŒÙ‡
        // if (introMessage) {
        //   fill(255, 255, 255, 200);
        //   textSize(20);
        //   text("Ù‚Ù„Ø¨ Ø±Ùˆ Ø¨Ø´Ú©Ù†...", width / 2, height / 2 - 100);
        //   textSize(16); // Ø¨Ø±Ú¯Ø±Ø¯ Ø¨Ù‡ Ø³Ø§ÛŒØ² Ø§ØµÙ„ÛŒ
        // }

        // Ù‚Ù„Ø¨ Ø¨Ø§ Ø¶Ø±Ø¨Ø§Ù†
        if (heart.health > 0) {
          let pulse = 212 + 10 * sin(frameCount * 0.05); // Ø¶Ø±Ø¨Ø§Ù† Ø¨ÛŒÙ† 202 Ùˆ 222
          let shakeX = heart.shake > 0 ? random(-heart.shake, heart.shake) : 0;
          let shakeY = heart.shake > 0 ? random(-heart.shake, heart.shake) : 0;
          // Ø³Ø§ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ù‚Ù„Ø¨
          drawingContext.shadowBlur = 20;
          drawingContext.shadowColor = "rgba(255, 0, 0, 0.5)";
          image(
            heartImg,
            heart.x + shakeX - pulse / 2,
            heart.y + shakeY - pulse / 2,
            pulse,
            pulse
          );
          drawingContext.shadowBlur = 0; // Ø®Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù† Ø³Ø§ÛŒÙ‡
          heart.shake *= 0.95;
        }

        // ØªÚ©Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ù„Ø¨
        for (let piece of heartPieces) {
          if (piece.alpha > 0) {
            push();
            translate(piece.x, piece.y);
            rotate(piece.rotation * frameCount);
            image(
              heartImg,
              -piece.size / 2,
              -piece.size / 2,
              piece.size,
              piece.size
            );
            pop();
            piece.x += piece.vx;
            piece.y += piece.vy;
            piece.vy += 0.05;
            piece.alpha -= 0.5;
          }
        }

        // Ù…ØªÙ† Ø´Ø¹Ø± Ø¨Ø§ Ø­Ø±Ú©Øª Ú†Ø±Ø®Ø´ÛŒ
        for (let i = poemParticles.length - 1; i >= 0; i--) {
          let p = poemParticles[i];
          fill(255, 255, 255, p.alpha);
          push();
          translate(p.x, p.y);
          //   rotate(p.rotation * frameCount);
          text(p.text, 0, 0);
          pop();
          p.x += p.vx;
          p.y += p.vy + 0.1;
          p.vx *= 0.99;
          p.vy *= 0.99;
          p.rotation += 0.01;
          p.alpha -= 2;
          if (p.alpha <= 0) poemParticles.splice(i, 1);
        }

        // Ú†Ø§Ù‚Ùˆ Ø¨Ø§ Ø³Ø§ÛŒÙ‡
        drawingContext.shadowBlur = 15;
        drawingContext.shadowColor = "rgba(255, 255, 255, 0.3)";
        image(
          bladeImg,
          blade.x - blade.width / 2,
          blade.y - blade.height / 2,
          blade.width,
          blade.height
        );
        drawingContext.shadowBlur = 0;

        // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù¾Ø§ÛŒØ§Ù†
        if (heart.health <= 0 && !endAnimation) {
          endAnimation = true;
          for (let i = 0; i < 20; i++) {
            heartPieces.push({
              x: heart.x + random(-30, 30),
              y: heart.y + random(-30, 30),
              size: random(20, 40),
              vx: random(-3, 3),
              vy: random(-3, 0),
              rotation: random(-0.05, 0.05),
              alpha: 255,
            });
          }
        }
        if (endAnimation) {
          endAlpha += 2;
          fill(200, 0, 0, endAlpha);
          rect(0, 0, width, height);
          if (endAlpha >= 255) endAlpha = 255;
        }

        // ØªØ´Ø®ÛŒØµ Ø¶Ø±Ø¨Ù‡
        let isTouching = isBladeTouchingHeart();
        if (heart.health > 0 && isTouching && !isBladeActive) {
          if (frameCount % 8 === 0) {
            isBladeActive = true;
            introMessage = false; // Ø®Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ø§ÙˆÙ„ÛŒÙ‡
            scratches.push({
              x1: blade.x + random(-15, 15),
              y1: blade.y + random(-15, 15),
              x2: blade.x + random(-25, 25),
              y2: blade.y + random(-25, 25),
              alpha: 255,
            });
            // Ø°Ø±Ø§Øª Ø®ÙˆÙ† Ù¾ÛŒØ´Ø±ÙØªÙ‡
            for (let i = 0; i < 6; i++) {
              bloodParticles.push({
                x: blade.x,
                y: blade.y,
                vx: random(-3, 3),
                vy: random(-3, -1),
                alpha: 255,
                size: random(5, 15),
                arc: random(-0.1, 0.1),
              });
            }
            if (poemIndex < currentPoem.length) {
              poemParticles.push({
                x: blade.x,
                y: blade.y,
                vx: random(-1, 1),
                vy: random(-2, 0),
                alpha: 255,
                text: currentPoem[poemIndex],
                rotation: random(-0.02, 0.02),
              });
              poemIndex++;
            }
            heart.shake = 5;
            heart.health--;
            if (heart.health % 2 === 0) {
              heartPieces.push({
                x: heart.x + random(-20, 20),
                y: heart.y + random(-20, 20),
                size: random(20, 40),
                vx: random(-1.5, 1.5),
                vy: random(-2, 0),
                rotation: random(-0.03, 0.03),
                alpha: 255,
              });
            }
          }
        }
        if (!isTouching) {
          isBladeActive = false;
        }

        // Ø®Ø· Ùˆ Ø®Ø´â€ŒÙ‡Ø§
        for (let i = scratches.length - 1; i >= 0; i--) {
          let scratch = scratches[i];
          stroke(200, 0, 0, scratch.alpha);
          strokeWeight(2);
          line(scratch.x1, scratch.y1, scratch.x2, scratch.y2);
          scratch.alpha -= 2;
          if (scratch.alpha <= 0) scratches.splice(i, 1);
        }

        // Ø°Ø±Ø§Øª Ø®ÙˆÙ†
        noStroke();
        for (let i = bloodParticles.length - 1; i >= 0; i--) {
          let p = bloodParticles[i];
          fill(200, 0, 0, p.alpha);
          ellipse(p.x, p.y, p.size, p.size);
          p.x += p.vx + p.arc * frameCount;
          p.y += p.vy + 0.15;
          p.vx *= 0.98;
          p.vy *= 0.98;
          p.alpha -= 2;
          p.size *= 0.99;
          if (p.alpha <= 0) bloodParticles.splice(i, 1);
        }
      }

      function isBladeTouchingHeart() {
        let dx = blade.x - heart.x;
        let dy = blade.y - heart.y;
        let distance = sqrt(dx * dx + dy * dy);
        return distance < heart.size / 2;
      }

      function resetAnimation() {
        heart = {
          x: width / 2,
          y: height / 2,
          size: 212,
          health: currentPoem.length + 1,
          shake: 0,
        };
        blade = {
          x: width / 2,
          y: height / 2,
          displayX: width / 2,
          displayY: height / 2,
          width: 60,
          height: 120,
        };
        heartPieces = [];
        scratches = [];
        bloodParticles = [];
        poemParticles = [];
        poemIndex = 0;
        isBladeActive = false;
        introMessage = true;
        endAnimation = false;
        endAlpha = 0;
      }

      function windowResized() {
        resizeCanvas(min(windowWidth, 800), min(windowHeight, 600));
        heart.x = width / 2;
        heart.y = height / 2;
      }
    </script>
  </body>
</html>
